<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <title>MedWard - Clinical Intelligence Platform</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    
    :root {
      --bg-primary: #0a0f1a;
      --bg-secondary: #111827;
      --bg-tertiary: #1a2234;
      --text-primary: #f8fafc;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --accent-gold: #f0c674;
      --accent-teal: #2dd4bf;
      --border: #2a3548;
      --radius: 12px;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.5;
    }
    
    /* Debug Panel */
    #debug-panel {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      max-height: 40vh;
      background: rgba(0,0,0,0.95);
      border-top: 2px solid #ef4444;
      font-family: monospace;
      font-size: 11px;
      z-index: 9999;
      overflow-y: auto;
    }
    
    #debug-panel.hidden { display: none; }
    
    .debug-header {
      position: sticky;
      top: 0;
      background: #1e1e1e;
      padding: 8px 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #333;
    }
    
    .debug-header h4 { color: #ef4444; margin: 0; }
    
    .debug-btn {
      padding: 4px 8px;
      background: #333;
      border: 1px solid #555;
      color: #fff;
      border-radius: 4px;
      font-size: 10px;
      cursor: pointer;
    }
    
    #debug-log {
      padding: 8px 12px;
      color: #0f0;
    }
    
    .log-entry { 
      padding: 2px 0; 
      border-bottom: 1px solid #222;
    }
    .log-entry.error { color: #ef4444; }
    .log-entry.warn { color: #fbbf24; }
    .log-entry.info { color: #60a5fa; }
    .log-entry.success { color: #10b981; }
    
    /* Toggle Button */
    #debug-toggle {
      position: fixed;
      bottom: 10px;
      right: 10px;
      width: 50px;
      height: 50px;
      background: #ef4444;
      color: white;
      border: none;
      border-radius: 50%;
      font-size: 20px;
      z-index: 10000;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
    }
    
    /* Header */
    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 60px;
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      z-index: 100;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .logo-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-teal));
      border-radius: 10px;
      display: grid;
      place-items: center;
    }
    
    .logo-icon svg { width: 24px; height: 24px; stroke: #000; }
    
    .logo-text {
      font-size: 1.25rem;
      font-weight: 700;
      background: linear-gradient(135deg, var(--text-primary), var(--accent-gold));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .nav-tabs {
      display: flex;
      gap: 4px;
      background: var(--bg-tertiary);
      padding: 4px;
      border-radius: 8px;
    }
    
    .nav-tab {
      padding: 8px 16px;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      font-size: 14px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .nav-tab.active {
      background: var(--bg-secondary);
      color: var(--accent-gold);
    }
    
    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .user-info.hidden { display: none; }
    
    .avatar {
      width: 36px;
      height: 36px;
      background: linear-gradient(135deg, var(--accent-gold), var(--accent-teal));
      border-radius: 50%;
      display: grid;
      place-items: center;
      font-weight: 600;
    }
    
    /* Screens */
    .screen {
      display: none;
      min-height: 100vh;
      padding-top: 80px;
      padding-bottom: 50vh; /* Space for debug panel */
    }
    
    .screen.active { display: block; }
    
    /* Login Screen */
    #login-screen.active {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    
    .login-card {
      width: 100%;
      max-width: 400px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 40px 30px;
      text-align: center;
    }
    
    .login-title {
      font-size: 1.5rem;
      margin-bottom: 8px;
    }
    
    .login-subtitle {
      color: var(--text-muted);
      margin-bottom: 30px;
    }
    
    .form-group { margin-bottom: 20px; }
    
    .form-input {
      width: 100%;
      padding: 14px 18px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 16px; /* Prevents iOS zoom */
      -webkit-appearance: none;
      appearance: none;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--accent-gold);
    }
    
    .form-input::placeholder { color: var(--text-muted); }
    
    /* THE BUTTON - Maximum compatibility */
    .login-btn {
      display: block;
      width: 100%;
      padding: 16px 24px;
      background: linear-gradient(135deg, var(--accent-gold), #d4a853);
      border: none;
      border-radius: 8px;
      color: #000;
      font-size: 16px;
      font-weight: 600;
      font-family: inherit;
      cursor: pointer;
      touch-action: manipulation;
      -webkit-tap-highlight-color: rgba(240, 198, 116, 0.5);
      -webkit-appearance: none;
      appearance: none;
      user-select: none;
      -webkit-user-select: none;
      position: relative;
      z-index: 50;
    }
    
    .login-btn:active {
      transform: scale(0.98);
      opacity: 0.9;
    }
    
    /* Dashboard */
    .dashboard-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .dashboard-header {
      margin-bottom: 30px;
    }
    
    .dashboard-title {
      font-size: 1.75rem;
      margin-bottom: 8px;
    }
    
    .dashboard-subtitle {
      color: var(--text-muted);
    }
    
    .card {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 24px;
      margin-bottom: 20px;
    }
    
    .card h3 {
      margin-bottom: 16px;
      color: var(--accent-gold);
    }
    
    .success-msg {
      padding: 20px;
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 8px;
      color: #10b981;
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="logo">
      <div class="logo-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke-width="2">
          <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
        </svg>
      </div>
      <span class="logo-text">MedWard</span>
    </div>
    
    <nav class="nav-tabs" id="nav-tabs">
      <button class="nav-tab active" data-screen="dashboard">Dashboard</button>
      <button class="nav-tab" data-screen="patients">Patients</button>
      <button class="nav-tab" data-screen="stroke">Stroke</button>
    </nav>
    
    <div class="user-info hidden" id="user-info">
      <div class="avatar" id="user-initial">?</div>
      <span id="user-name">User</span>
    </div>
  </header>

  <!-- Login Screen -->
  <main class="screen active" id="login-screen">
    <div class="login-card">
      <h1 class="login-title">Welcome to MedWard</h1>
      <p class="login-subtitle">Clinical Intelligence Platform</p>
      
      <div class="form-group">
        <input 
          type="text" 
          id="username-input" 
          class="form-input" 
          placeholder="Enter your name"
          autocomplete="off"
          autocapitalize="words"
        >
      </div>
      
      <!-- Multiple event handlers for maximum compatibility -->
      <button 
        type="button"
        id="login-btn" 
        class="login-btn"
        onclick="handleLoginClick('onclick')"
        ontouchend="handleLoginClick('ontouchend')"
      >Continue</button>
      
      <p style="margin-top: 20px; font-size: 12px; color: var(--text-muted);">
        Tap the button or press Enter
      </p>
    </div>
  </main>

  <!-- Dashboard Screen -->
  <main class="screen" id="dashboard-screen">
    <div class="dashboard-container">
      <header class="dashboard-header">
        <h1 class="dashboard-title">Clinical Analysis</h1>
        <p class="dashboard-subtitle">Upload medical reports for AI-powered interpretation</p>
      </header>
      
      <div class="card">
        <h3>üéâ Login Successful!</h3>
        <div class="success-msg">
          <p>Welcome to MedWard, <strong id="welcome-name">User</strong>!</p>
          <p style="margin-top: 10px; font-size: 14px; color: var(--text-muted);">
            The login is working correctly. Check the debug panel below for details.
          </p>
        </div>
      </div>
      
      <div class="card">
        <h3>Debug Information</h3>
        <p>If you see this screen, the login functionality is working.</p>
        <p style="margin-top: 10px;">
          <button onclick="doLogout()" style="padding: 10px 20px; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer;">
            Logout & Test Again
          </button>
        </p>
      </div>
    </div>
  </main>

  <!-- Debug Toggle Button -->
  <button id="debug-toggle" onclick="toggleDebug()">üêõ</button>

  <!-- Debug Panel -->
  <div id="debug-panel">
    <div class="debug-header">
      <h4>üîç Debug Console</h4>
      <div>
        <button class="debug-btn" onclick="clearLog()">Clear</button>
        <button class="debug-btn" onclick="testEvents()">Test Events</button>
        <button class="debug-btn" onclick="document.getElementById('debug-panel').classList.add('hidden')">Hide</button>
      </div>
    </div>
    <div id="debug-log"></div>
  </div>

  <script>
    // ==========================================
    // DEBUG SYSTEM
    // ==========================================
    var debugLog = [];
    
    function log(msg, type) {
      type = type || 'info';
      var time = new Date().toLocaleTimeString();
      var entry = '[' + time + '] ' + msg;
      debugLog.push({ msg: entry, type: type });
      
      var logEl = document.getElementById('debug-log');
      if (logEl) {
        var div = document.createElement('div');
        div.className = 'log-entry ' + type;
        div.textContent = entry;
        logEl.appendChild(div);
        logEl.scrollTop = logEl.scrollHeight;
      }
      
      console.log('[' + type.toUpperCase() + ']', msg);
    }
    
    function clearLog() {
      debugLog = [];
      var logEl = document.getElementById('debug-log');
      if (logEl) logEl.innerHTML = '';
      log('Log cleared', 'info');
    }
    
    function toggleDebug() {
      var panel = document.getElementById('debug-panel');
      panel.classList.toggle('hidden');
    }
    
    // ==========================================
    // INITIALIZATION
    // ==========================================
    log('=== MedWard Debug Version ===', 'info');
    log('User Agent: ' + navigator.userAgent.substring(0, 50) + '...', 'info');
    log('Touch Support: ' + ('ontouchstart' in window), 'info');
    log('Pointer Support: ' + ('onpointerdown' in window), 'info');
    
    document.addEventListener('DOMContentLoaded', function() {
      log('DOM Content Loaded', 'success');
      
      var loginBtn = document.getElementById('login-btn');
      var usernameInput = document.getElementById('username-input');
      
      if (!loginBtn) {
        log('ERROR: login-btn NOT FOUND!', 'error');
        return;
      }
      
      log('login-btn found: ' + loginBtn.tagName, 'success');
      log('Button dimensions: ' + loginBtn.offsetWidth + 'x' + loginBtn.offsetHeight, 'info');
      log('Button visible: ' + (loginBtn.offsetParent !== null), 'info');
      
      // Check for overlapping elements
      var rect = loginBtn.getBoundingClientRect();
      log('Button position: top=' + rect.top.toFixed(0) + ', left=' + rect.left.toFixed(0), 'info');
      
      var elementAtPoint = document.elementFromPoint(rect.left + rect.width/2, rect.top + rect.height/2);
      if (elementAtPoint !== loginBtn) {
        log('WARNING: Element at button center is NOT the button!', 'error');
        log('Element at center: ' + (elementAtPoint ? elementAtPoint.tagName + '#' + elementAtPoint.id : 'null'), 'error');
      } else {
        log('Element at button center: CORRECT', 'success');
      }
      
      // Add ALL possible event listeners
      var events = ['click', 'touchstart', 'touchend', 'pointerdown', 'pointerup', 'mousedown', 'mouseup'];
      
      events.forEach(function(eventName) {
        loginBtn.addEventListener(eventName, function(e) {
          log('Event: ' + eventName + ' fired!', 'success');
          
          if (eventName === 'click' || eventName === 'touchend' || eventName === 'pointerup') {
            // Prevent duplicate handling
            if (e.type === 'touchend') {
              e.preventDefault(); // Prevent ghost click
            }
            doLogin(eventName);
          }
        }, { passive: false });
      });
      
      log('All event listeners attached', 'success');
      
      // Enter key handler
      if (usernameInput) {
        usernameInput.addEventListener('keydown', function(e) {
          log('Key pressed: ' + e.key, 'info');
          if (e.key === 'Enter') {
            e.preventDefault();
            doLogin('Enter key');
          }
        });
        log('Enter key listener attached', 'success');
      }
      
      // Check for stored session
      checkStoredSession();
    });
    
    // ==========================================
    // LOGIN LOGIC
    // ==========================================
    var loginInProgress = false;
    
    function handleLoginClick(source) {
      log('handleLoginClick called from: ' + source, 'info');
      // This is a backup - main logic is in event listeners
    }
    
    function doLogin(source) {
      if (loginInProgress) {
        log('Login already in progress, ignoring', 'warn');
        return;
      }
      
      loginInProgress = true;
      setTimeout(function() { loginInProgress = false; }, 500);
      
      log('doLogin called from: ' + source, 'info');
      
      var input = document.getElementById('username-input');
      var username = input ? input.value.trim() : '';
      
      log('Username value: "' + username + '"', 'info');
      
      if (!username) {
        log('Username is empty!', 'error');
        alert('Please enter your name');
        if (input) input.focus();
        return;
      }
      
      log('Processing login for: ' + username, 'info');
      
      // Save to localStorage
      var user = { 
        name: username, 
        initial: username.charAt(0).toUpperCase(),
        timestamp: Date.now()
      };
      
      try {
        localStorage.setItem('medward_user', JSON.stringify(user));
        log('Saved to localStorage', 'success');
      } catch (e) {
        log('localStorage error: ' + e.message, 'error');
      }
      
      // Switch screens
      switchToScreen('dashboard', user);
    }
    
    function switchToScreen(screenName, user) {
      log('Switching to screen: ' + screenName, 'info');
      
      // Hide all screens
      var screens = document.querySelectorAll('.screen');
      screens.forEach(function(s) {
        s.classList.remove('active');
        log('Removed active from: ' + s.id, 'info');
      });
      
      // Show target screen
      var target = document.getElementById(screenName + '-screen');
      if (target) {
        target.classList.add('active');
        log('Added active to: ' + target.id, 'success');
      } else {
        log('Target screen not found: ' + screenName + '-screen', 'error');
      }
      
      // Update user info
      if (user) {
        var userInfo = document.getElementById('user-info');
        var userInitial = document.getElementById('user-initial');
        var userName = document.getElementById('user-name');
        var welcomeName = document.getElementById('welcome-name');
        
        if (userInfo) {
          userInfo.classList.remove('hidden');
          log('User info shown', 'success');
        }
        if (userInitial) userInitial.textContent = user.initial;
        if (userName) userName.textContent = user.name;
        if (welcomeName) welcomeName.textContent = user.name;
        
        log('User display updated', 'success');
      }
      
      log('Screen switch complete!', 'success');
    }
    
    function doLogout() {
      log('Logging out...', 'info');
      
      try {
        localStorage.removeItem('medward_user');
        log('Cleared localStorage', 'success');
      } catch (e) {
        log('localStorage error: ' + e.message, 'error');
      }
      
      // Reset UI
      document.getElementById('user-info').classList.add('hidden');
      document.getElementById('username-input').value = '';
      
      // Switch to login
      var screens = document.querySelectorAll('.screen');
      screens.forEach(function(s) { s.classList.remove('active'); });
      document.getElementById('login-screen').classList.add('active');
      
      log('Logged out successfully', 'success');
    }
    
    function checkStoredSession() {
      log('Checking for stored session...', 'info');
      
      try {
        var stored = localStorage.getItem('medward_user');
        if (stored) {
          var user = JSON.parse(stored);
          log('Found stored user: ' + user.name, 'success');
          
          // Auto-login
          switchToScreen('dashboard', user);
        } else {
          log('No stored session', 'info');
        }
      } catch (e) {
        log('Session check error: ' + e.message, 'error');
      }
    }
    
    // ==========================================
    // EVENT TESTING
    // ==========================================
    function testEvents() {
      log('=== Running Event Tests ===', 'info');
      
      var btn = document.getElementById('login-btn');
      if (!btn) {
        log('Button not found!', 'error');
        return;
      }
      
      // Test click
      log('Dispatching synthetic click...', 'info');
      var clickEvent = new MouseEvent('click', {
        bubbles: true,
        cancelable: true,
        view: window
      });
      btn.dispatchEvent(clickEvent);
      
      log('Event test complete', 'success');
    }
    
    // ==========================================
    // NAVIGATION
    // ==========================================
    document.addEventListener('DOMContentLoaded', function() {
      var tabs = document.querySelectorAll('.nav-tab');
      tabs.forEach(function(tab) {
        tab.addEventListener('click', function() {
          var screen = this.getAttribute('data-screen');
          log('Nav tab clicked: ' + screen, 'info');
          
          // Update tabs
          tabs.forEach(function(t) { t.classList.remove('active'); });
          this.classList.add('active');
          
          // Check if logged in
          var stored = localStorage.getItem('medward_user');
          if (!stored && screen !== 'login') {
            log('Not logged in, staying on login', 'warn');
            return;
          }
          
          // Switch screen
          var screens = document.querySelectorAll('.screen');
          screens.forEach(function(s) { s.classList.remove('active'); });
          
          var target = document.getElementById(screen + '-screen');
          if (target) {
            target.classList.add('active');
          }
        });
      });
    });
    
    // ==========================================
    // GLOBAL ERROR HANDLER
    // ==========================================
    window.onerror = function(msg, url, line, col, error) {
      log('JS ERROR: ' + msg + ' at line ' + line, 'error');
      return false;
    };
    
    log('Script loaded successfully', 'success');
  </script>
</body>
</html>
