<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <meta name="theme-color" content="#060a13">
  <title>MedWard Enterprise</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
:root{--bg-deep:#060a13;--bg-primary:#0a0f1a;--bg-card:#0d1424;--bg-elevated:#111b2e;--bg-input:#0f172a;--text-primary:#f8fafc;--text-secondary:#94a3b8;--text-muted:#64748b;--gold:#d4a437;--gold-light:#fbbf24;--gold-glow:rgba(212,164,55,0.15);--teal:#14b8a6;--teal-light:#2dd4bf;--blue:#3b82f6;--purple:#8b5cf6;--rose:#f43f5e;--orange:#f97316;--emerald:#10b981;--border:rgba(148,163,184,0.1);--shadow-lg:0 12px 40px rgba(0,0,0,0.5);--radius-sm:8px;--radius-md:12px;--radius-lg:16px;--radius-xl:20px}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',system-ui,sans-serif;background:var(--bg-deep);color:var(--text-primary);line-height:1.5;min-height:100vh}
.ambient{position:fixed;inset:0;pointer-events:none;z-index:-1;background:radial-gradient(ellipse at 20% 20%,var(--gold-glow),transparent 50%),radial-gradient(ellipse at 80% 80%,rgba(20,184,166,0.08),transparent 50%)}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:14px 24px;border:none;border-radius:var(--radius-md);font-family:inherit;font-size:0.95rem;font-weight:600;cursor:pointer;transition:0.2s}
.btn-primary{background:linear-gradient(135deg,var(--gold),var(--gold-light));color:var(--bg-deep);box-shadow:0 4px 16px rgba(212,164,55,0.3)}
.btn-secondary{background:var(--bg-elevated);border:1px solid var(--border);color:var(--text-primary)}
.btn-sm{padding:8px 14px;font-size:0.8rem}
.btn-lg{padding:16px 28px;font-size:1rem}
.btn-full{width:100%}
.btn-icon{width:40px;height:40px;padding:0;background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text-secondary);cursor:pointer;display:grid;place-items:center;transition:0.2s}
.btn-icon:hover{border-color:var(--gold);color:var(--gold)}
.form-group{margin-bottom:20px}
.form-label{display:block;font-size:0.75rem;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:8px}
.form-input,.form-select,.form-textarea{width:100%;padding:14px 16px;background:var(--bg-input);border:1px solid var(--border);border-radius:var(--radius-md);color:var(--text-primary);font-family:inherit;font-size:0.95rem;transition:0.2s}
.form-input:focus,.form-select:focus{outline:none;border-color:var(--gold);box-shadow:0 0 0 3px var(--gold-glow)}
.form-textarea{min-height:100px;resize:vertical}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.9);display:none;align-items:center;justify-content:center;padding:20px;z-index:1000}
.modal.active{display:flex}
.modal-box{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-xl);width:100%;max-width:480px;max-height:90vh;overflow-y:auto}
.modal-header{padding:24px;border-bottom:1px solid var(--border);text-align:center}
.modal-icon{width:64px;height:64px;background:var(--bg-elevated);border-radius:16px;display:grid;place-items:center;font-size:2rem;margin:0 auto 16px}
.modal-title{font-size:1.25rem;font-weight:700;margin-bottom:4px}
.modal-subtitle{color:var(--text-muted);font-size:0.85rem}
.modal-body{padding:24px}
.modal-footer{padding:16px 24px 24px;display:flex;gap:12px}
.modal-footer .btn{flex:1}
#landing{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:24px}
#landing.hidden{display:none}
.landing-logo{width:88px;height:88px;background:linear-gradient(135deg,var(--gold),var(--gold-light));border-radius:22px;display:grid;place-items:center;margin-bottom:28px;box-shadow:0 12px 40px rgba(212,164,55,0.3)}
.landing-logo svg{width:48px;height:48px;stroke:var(--bg-deep);stroke-width:2.5;fill:none}
.landing-title{font-size:2.25rem;font-weight:800;margin-bottom:8px;background:linear-gradient(135deg,var(--gold),var(--teal));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.landing-subtitle{color:var(--text-secondary);margin-bottom:48px}
.units-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:20px;width:100%;max-width:880px}
.unit-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);padding:24px;cursor:pointer;transition:0.3s;position:relative;overflow:hidden}
.unit-card::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:var(--unit-color,var(--gold))}
.unit-card:hover{border-color:var(--unit-color,var(--gold));transform:translateY(-4px);box-shadow:0 16px 48px rgba(0,0,0,0.3)}
.unit-card-icon{width:52px;height:52px;background:var(--bg-elevated);border-radius:14px;display:grid;place-items:center;font-size:1.6rem;margin-bottom:14px}
.unit-card-name{font-size:1.15rem;font-weight:600;margin-bottom:4px}
.unit-card-desc{color:var(--text-muted);font-size:0.8rem}
.unit-card-lock{position:absolute;top:16px;right:16px;width:28px;height:28px;background:var(--bg-elevated);border-radius:8px;display:grid;place-items:center;color:var(--text-muted)}
.unit-card-lock svg{width:14px;height:14px}
.admin-fab{position:fixed;bottom:24px;right:24px;width:56px;height:56px;background:var(--bg-card);border:1px solid var(--border);border-radius:50%;display:grid;place-items:center;cursor:pointer;transition:0.3s;color:var(--text-muted);z-index:50}
.admin-fab:hover{border-color:var(--gold);color:var(--gold);transform:scale(1.1)}
.admin-fab svg{width:22px;height:22px}
.code-inputs{display:flex;gap:12px;justify-content:center;margin-bottom:20px}
.code-digit{width:52px;height:60px;background:var(--bg-elevated);border:2px solid var(--border);border-radius:var(--radius-md);font-family:'JetBrains Mono',monospace;font-size:1.75rem;font-weight:600;text-align:center;color:var(--text-primary);transition:0.2s}
.code-digit:focus{outline:none;border-color:var(--gold);background:var(--gold-glow)}
.code-digit.error{border-color:var(--rose);animation:shake 0.4s}
.code-digit.success{border-color:var(--emerald);background:rgba(16,185,129,0.1)}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-6px)}75%{transform:translateX(6px)}}
.code-error{color:var(--rose);font-size:0.85rem;text-align:center;margin-top:12px;display:none}
.code-error.show{display:block}
#dashboard{display:none;min-height:100vh;background:var(--bg-primary)}
#dashboard.active{display:block}
.dash-header{background:var(--bg-card);border-bottom:1px solid var(--border);padding:12px 20px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100}
.dash-logo{display:flex;align-items:center;gap:12px}
.dash-logo-icon{width:40px;height:40px;background:linear-gradient(135deg,var(--gold),var(--gold-light));border-radius:10px;display:grid;place-items:center}
.dash-logo-icon svg{width:22px;height:22px;stroke:var(--bg-deep);fill:none}
.dash-unit-badge{padding:6px 14px;border-radius:100px;font-size:0.8rem;font-weight:600}
.dash-user{display:flex;align-items:center;gap:12px}
.dash-user-info{text-align:right}
.dash-user-name{font-weight:600;font-size:0.9rem}
.dash-user-role{font-size:0.7rem;color:var(--text-muted);text-transform:capitalize}
.dash-avatar{width:40px;height:40px;background:linear-gradient(135deg,var(--teal),var(--emerald));border-radius:10px;display:grid;place-items:center;font-weight:700;font-size:0.85rem}
.dash-content{max-width:1200px;margin:0 auto;padding:20px}
.tabs{display:flex;border-bottom:1px solid var(--border);margin-bottom:24px;overflow-x:auto}
.tab{padding:14px 20px;background:transparent;border:none;border-bottom:2px solid transparent;color:var(--text-muted);font-family:inherit;font-size:0.85rem;font-weight:500;cursor:pointer;transition:0.2s;white-space:nowrap;display:flex;align-items:center;gap:8px}
.tab:hover{color:var(--text-primary)}
.tab.active{color:var(--gold);border-bottom-color:var(--gold);font-weight:600}
.tab svg{width:18px;height:18px}
.panel{display:none;animation:fadeIn 0.3s}
.panel.active{display:block}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:24px}
.stat-card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-md);padding:18px;text-align:center}
.stat-value{font-size:1.75rem;font-weight:700;background:linear-gradient(135deg,var(--gold),var(--teal));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.stat-label{font-size:0.7rem;color:var(--text-muted);text-transform:uppercase;margin-top:4px}
.patients-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:16px}
.patient-card{background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-lg);padding:20px;transition:0.2s;position:relative;overflow:hidden}
.patient-card:hover{border-color:var(--gold)}
.patient-card::before{content:'';position:absolute;top:0;left:0;width:4px;height:100%;background:var(--teal)}
.patient-card.critical::before{background:var(--rose)}
.patient-card.chronic::before{background:var(--purple)}
.patient-header{display:flex;align-items:center;gap:12px;margin-bottom:14px}
.patient-avatar{width:48px;height:48px;background:linear-gradient(135deg,var(--gold),var(--teal));border-radius:12px;display:grid;place-items:center;font-weight:700;font-size:1rem;color:var(--bg-deep)}
.patient-name{font-weight:600}
.patient-meta{font-size:0.75rem;color:var(--text-muted)}
.patient-status{margin-left:auto;padding:4px 10px;border-radius:100px;font-size:0.65rem;font-weight:600;text-transform:uppercase}
.patient-status.active{background:rgba(20,184,166,0.15);color:var(--teal)}
.patient-status.critical{background:rgba(244,63,94,0.15);color:var(--rose)}
.patient-status.chronic{background:rgba(139,92,246,0.15);color:var(--purple)}
.patient-diagnosis{font-size:0.85rem;color:var(--text-secondary);padding:12px;background:var(--bg-card);border-radius:8px;margin-bottom:14px}
.patient-actions{display:flex;gap:8px}
.patient-actions .btn{flex:1;padding:10px;font-size:0.8rem}
.card{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden;margin-bottom:20px}
.card-header{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.card-title{font-size:0.95rem;font-weight:600;display:flex;align-items:center;gap:10px}
.card-body{padding:20px}
.upload-zone{border:2px dashed var(--border);border-radius:var(--radius-lg);padding:40px 24px;text-align:center;cursor:pointer;transition:0.2s}
.upload-zone:hover,.upload-zone.dragover{border-color:var(--gold);background:var(--gold-glow)}
.upload-zone.has-file{border-style:solid;border-color:var(--teal)}
.upload-icon{width:56px;height:56px;background:var(--bg-elevated);border-radius:14px;display:grid;place-items:center;margin:0 auto 16px}
.upload-icon svg{width:28px;height:28px;stroke:var(--gold)}
.analysis-types{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:10px;margin-top:16px}
.analysis-type{background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-md);padding:16px 12px;text-align:center;cursor:pointer;transition:0.2s}
.analysis-type:hover,.analysis-type.active{border-color:var(--gold);background:var(--gold-glow)}
.analysis-type-icon{font-size:1.5rem;margin-bottom:6px}
.analysis-type-name{font-size:0.8rem;font-weight:600}
.scores-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:12px}
.score-tile{background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-md);padding:20px 16px;text-align:center;cursor:pointer;transition:0.2s}
.score-tile:hover,.score-tile.active{border-color:var(--gold);background:var(--gold-glow)}
.score-icon{font-size:1.75rem;margin-bottom:8px}
.score-name{font-weight:600;font-size:0.9rem}
.score-desc{font-size:0.7rem;color:var(--text-muted)}
.ref-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px}
.ref-card{background:var(--bg-elevated);border-radius:var(--radius-md);padding:16px;border-left:3px solid var(--gold)}
.ref-card h4{font-size:0.9rem;margin-bottom:10px}
.ref-card p{font-size:0.78rem;color:var(--text-secondary);margin:5px 0}
.ref-card b{color:var(--gold)}
#adminPanel{display:none;min-height:100vh;background:var(--bg-primary)}
#adminPanel.active{display:block}
.admin-header{background:var(--bg-card);border-bottom:1px solid var(--border);padding:16px 24px;display:flex;align-items:center;justify-content:space-between}
.admin-badge{background:var(--purple);padding:4px 12px;border-radius:100px;font-size:0.7rem;font-weight:600;color:white;margin-left:12px}
.admin-content{max-width:900px;margin:0 auto;padding:24px}
.admin-section{background:var(--bg-card);border:1px solid var(--border);border-radius:var(--radius-lg);margin-bottom:24px;overflow:hidden}
.admin-section-header{padding:18px 24px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.admin-section-title{font-size:1rem;font-weight:600}
.admin-section-body{padding:20px}
.units-table{width:100%;border-collapse:collapse}
.units-table th,.units-table td{padding:14px 16px;text-align:left;border-bottom:1px solid var(--border)}
.units-table th{font-size:0.7rem;font-weight:600;color:var(--text-muted);text-transform:uppercase}
.color-options{display:flex;gap:8px;flex-wrap:wrap}
.color-option{width:32px;height:32px;border-radius:8px;cursor:pointer;border:2px solid transparent;transition:0.2s}
.color-option:hover,.color-option.selected{border-color:white;transform:scale(1.15)}
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--bg-card);border:1px solid var(--emerald);padding:14px 24px;border-radius:var(--radius-md);font-size:0.9rem;opacity:0;transition:0.3s;z-index:2000}
.toast.show{transform:translateX(-50%) translateY(0);opacity:1}
.toast.error{border-color:var(--rose)}
@media(max-width:640px){.landing-title{font-size:1.75rem}.units-grid{grid-template-columns:1fr}.stats-grid{grid-template-columns:repeat(2,1fr)}.dash-user-info{display:none}.tab span{display:none}.patients-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
<div class="ambient"></div>

<!-- LANDING -->
<div id="landing">
  <div class="landing-logo"><svg viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg></div>
  <h1 class="landing-title">MedWard Enterprise</h1>
  <p class="landing-subtitle">Select your unit to continue</p>
  <div class="units-grid" id="unitsGrid"></div>
  <div class="admin-fab" onclick="App.openAdminLogin()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></div>
</div>

<!-- ACCESS MODAL -->
<div class="modal" id="accessModal">
  <div class="modal-box">
    <div class="modal-header">
      <div class="modal-icon" id="accessIcon">üè•</div>
      <h2 class="modal-title" id="accessTitle">Unit</h2>
      <p class="modal-subtitle">Enter 4-digit access code</p>
    </div>
    <div class="modal-body">
      <div class="code-inputs" id="codeInputs"></div>
      <p class="code-error" id="codeError">Invalid access code</p>
      <div id="userSection" style="display:none;margin-top:24px;padding-top:24px;border-top:1px solid var(--border)">
        <div class="form-group"><label class="form-label">Your Name</label><input type="text" id="userName" class="form-input" placeholder="Dr. John Smith"></div>
        <div class="form-group"><label class="form-label">Role</label><select id="userRole" class="form-select"><option value="attending">Attending</option><option value="resident">Resident</option><option value="intern">Intern</option><option value="nurse">Nurse</option></select></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="App.closeModal('accessModal')">Cancel</button>
      <button class="btn btn-primary" id="enterUnitBtn" style="display:none" onclick="App.enterUnit()">Enter Unit</button>
    </div>
  </div>
</div>

<!-- ADMIN LOGIN -->
<div class="modal" id="adminLoginModal">
  <div class="modal-box">
    <div class="modal-header">
      <div class="modal-icon">‚öôÔ∏è</div>
      <h2 class="modal-title">Admin Access</h2>
      <p class="modal-subtitle">Enter administrator password</p>
    </div>
    <div class="modal-body">
      <div class="form-group"><label class="form-label">Password</label><input type="password" id="adminPwd" class="form-input" placeholder="Enter password"></div>
      <p class="code-error" id="adminError">Invalid password</p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="App.closeModal('adminLoginModal')">Cancel</button>
      <button class="btn btn-primary" onclick="App.loginAdmin()">Login</button>
    </div>
  </div>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel">
  <header class="admin-header">
    <div class="dash-logo"><div class="dash-logo-icon"><svg viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2" stroke-width="2"/></svg></div><span style="font-weight:600;margin-left:8px">MedWard</span><span class="admin-badge">ADMIN</span></div>
    <button class="btn btn-secondary btn-sm" onclick="App.exitAdmin()">Exit</button>
  </header>
  <div class="admin-content">
    <div class="admin-section">
      <div class="admin-section-header"><h2 class="admin-section-title">üè• Units</h2><button class="btn btn-primary btn-sm" onclick="App.addUnit()">+ Add Unit</button></div>
      <div class="admin-section-body" style="padding:0"><table class="units-table"><thead><tr><th>Unit</th><th>Code</th><th>Actions</th></tr></thead><tbody id="unitsTableBody"></tbody></table></div>
    </div>
    <div class="admin-section">
      <div class="admin-section-header"><h2 class="admin-section-title">‚öôÔ∏è Settings</h2></div>
      <div class="admin-section-body">
        <div class="form-group"><label class="form-label">New Admin Password</label><input type="password" id="newAdminPwd" class="form-input" placeholder="Leave blank to keep current"></div>
        <div class="form-group"><label class="form-label">Claude API URL</label><input type="text" id="apiUrl" class="form-input" placeholder="Apps Script URL"></div>
        <button class="btn btn-primary" onclick="App.saveSettings()">Save Settings</button>
      </div>
    </div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard">
  <header class="dash-header">
    <div class="dash-logo">
      <div class="dash-logo-icon"><svg viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2" stroke-width="2"/></svg></div>
      <span class="dash-unit-badge" id="unitBadge">Unit</span>
    </div>
    <div class="dash-user">
      <div class="dash-user-info"><div class="dash-user-name" id="userName2">Doctor</div><div class="dash-user-role" id="userRole2">Role</div></div>
      <div class="dash-avatar" id="userAvatar">DR</div>
      <button class="btn-icon" onclick="App.logout()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg></button>
    </div>
  </header>
  <div class="dash-content">
    <h1 style="font-size:1.5rem;margin-bottom:4px" id="welcomeMsg">Welcome back</h1>
    <p style="color:var(--text-muted);margin-bottom:24px" id="dateStr"></p>
    <div class="tabs">
      <button class="tab active" onclick="App.showTab('patients')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg><span>Patients</span></button>
      <button class="tab" onclick="App.showTab('analysis')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/></svg><span>AI Analysis</span></button>
      <button class="tab" onclick="App.showTab('scores')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg><span>Scores</span></button>
      <button class="tab" onclick="App.showTab('reference')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg><span>Reference</span></button>
    </div>
    
    <!-- Patients Panel -->
    <div class="panel active" id="panelPatients">
      <div class="stats-grid">
        <div class="stat-card"><div class="stat-value" id="statTotal">0</div><div class="stat-label">Total</div></div>
        <div class="stat-card"><div class="stat-value" id="statActive">0</div><div class="stat-label">Active</div></div>
        <div class="stat-card"><div class="stat-value" id="statCritical">0</div><div class="stat-label">Critical</div></div>
        <div class="stat-card"><div class="stat-value" id="statChronic">0</div><div class="stat-label">Chronic</div></div>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
        <h2 style="font-size:1.1rem">Unit Patients</h2>
        <button class="btn btn-primary btn-sm" onclick="App.addPatient()">+ Add Patient</button>
      </div>
      <div class="patients-grid" id="patientsGrid"></div>
    </div>
    
    <!-- Analysis Panel -->
    <div class="panel" id="panelAnalysis">
      <div class="card">
        <div class="card-header"><h3 class="card-title">üì§ Upload Medical Images</h3></div>
        <div class="card-body">
          <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
            <div class="upload-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg></div>
            <div style="font-weight:600">Drop files or tap to upload</div>
            <div style="font-size:0.85rem;color:var(--text-muted)">PNG, JPG, HEIC supported</div>
          </div>
          <input type="file" id="fileInput" accept="image/*" multiple style="display:none" onchange="App.handleFiles(this.files)">
          <div class="analysis-types">
            <div class="analysis-type active" onclick="App.setAnalysisType(this,'lab')"><div class="analysis-type-icon">üß™</div><div class="analysis-type-name">Labs</div></div>
            <div class="analysis-type" onclick="App.setAnalysisType(this,'xray')"><div class="analysis-type-icon">ü©ª</div><div class="analysis-type-name">X-Ray</div></div>
            <div class="analysis-type" onclick="App.setAnalysisType(this,'ct')"><div class="analysis-type-icon">üß†</div><div class="analysis-type-name">CT/MRI</div></div>
            <div class="analysis-type" onclick="App.setAnalysisType(this,'ecg')"><div class="analysis-type-icon">üíì</div><div class="analysis-type-name">ECG</div></div>
          </div>
        </div>
      </div>
      <button class="btn btn-primary btn-lg btn-full" id="analyzeBtn" disabled onclick="App.analyze()">ü§ñ Analyze with Claude AI</button>
      <div id="analysisResults" style="margin-top:20px"></div>
    </div>
    
    <!-- Scores Panel -->
    <div class="panel" id="panelScores">
      <div class="card"><div class="card-header"><h3 class="card-title">Clinical Calculators</h3></div><div class="card-body"><div class="scores-grid" id="scoresGrid"></div></div></div>
      <div id="calcArea"></div>
    </div>
    
    <!-- Reference Panel -->
    <div class="panel" id="panelReference">
      <div class="card"><div class="card-header"><h3 class="card-title">Quick Reference</h3></div><div class="card-body"><div class="ref-grid" id="refGrid"></div></div></div>
    </div>
  </div>
</div>

<!-- PATIENT MODAL -->
<div class="modal" id="patientModal">
  <div class="modal-box">
    <div class="modal-header" style="text-align:left"><h2 class="modal-title">Add Patient</h2></div>
    <div class="modal-body">
      <div class="form-group"><label class="form-label">Name</label><input type="text" id="ptName" class="form-input" placeholder="Full name"></div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
        <div class="form-group"><label class="form-label">Room</label><input type="text" id="ptRoom" class="form-input" placeholder="21-A"></div>
        <div class="form-group"><label class="form-label">Status</label><select id="ptStatus" class="form-select"><option value="active">Active</option><option value="critical">Critical</option><option value="chronic">Chronic</option></select></div>
      </div>
      <div class="form-group"><label class="form-label">Diagnosis</label><textarea id="ptDiagnosis" class="form-textarea" placeholder="Primary diagnosis"></textarea></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="App.closeModal('patientModal')">Cancel</button>
      <button class="btn btn-primary" onclick="App.savePatient()">Save</button>
    </div>
  </div>
</div>

<!-- UNIT MODAL -->
<div class="modal" id="unitModal">
  <div class="modal-box">
    <div class="modal-header" style="text-align:left"><h2 class="modal-title" id="unitModalTitle">Add Unit</h2></div>
    <div class="modal-body">
      <div class="form-group"><label class="form-label">Unit Name</label><input type="text" id="unitName" class="form-input" placeholder="Neurology Ward"></div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
        <div class="form-group"><label class="form-label">Icon</label><input type="text" id="unitIcon" class="form-input" value="üè•" style="font-size:1.5rem;text-align:center"></div>
        <div class="form-group"><label class="form-label">Code (4 digits)</label><input type="text" id="unitCode" class="form-input" placeholder="1234" maxlength="4" style="text-align:center;letter-spacing:4px"></div>
      </div>
      <div class="form-group"><label class="form-label">Description</label><input type="text" id="unitDesc" class="form-input" placeholder="Brief description"></div>
      <div class="form-group"><label class="form-label">Color</label>
        <div class="color-options">
          <div class="color-option selected" style="background:#d4a437" onclick="App.selectColor(this)"></div>
          <div class="color-option" style="background:#14b8a6" onclick="App.selectColor(this)"></div>
          <div class="color-option" style="background:#3b82f6" onclick="App.selectColor(this)"></div>
          <div class="color-option" style="background:#a855f7" onclick="App.selectColor(this)"></div>
          <div class="color-option" style="background:#ef4444" onclick="App.selectColor(this)"></div>
          <div class="color-option" style="background:#f97316" onclick="App.selectColor(this)"></div>
          <div class="color-option" style="background:#10b981" onclick="App.selectColor(this)"></div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="App.closeModal('unitModal')">Cancel</button>
      <button class="btn btn-primary" onclick="App.saveUnit()">Save</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// MedWard Enterprise Application
var App = (function() {
  
  // Configuration
  var CONFIG = {
    STORAGE_KEY: 'medward_v5',
    ADMIN_PWD: 'admin123',
    API_URL: 'https://script.google.com/macros/s/AKfycbxjp-KDUx_eYvavlEHDciE-fR1V8eFM39vJfAcA7btETL-QUmrwuYU-_92_Pl20gl75kg/exec'
  };
  
  // Default Units
  var DEFAULT_UNITS = [
    { id: 'neuro', name: 'Neurology', icon: 'üß†', desc: 'Stroke & Neurological Disorders', code: '1234', color: '#a855f7' },
    { id: 'cardio', name: 'Cardiology', icon: '‚ù§Ô∏è', desc: 'Cardiac Care Unit', code: '5678', color: '#ef4444' },
    { id: 'icu', name: 'ICU', icon: 'üè•', desc: 'Intensive Care Unit', code: '9012', color: '#f97316' }
  ];
  
  // State
  var state = {
    units: [],
    settings: { adminPassword: CONFIG.ADMIN_PWD, apiUrl: CONFIG.API_URL },
    currentUnit: null,
    currentUser: null,
    patients: [],
    selectedUnitId: null,
    editingUnitId: null,
    analysisType: 'lab',
    uploadedImages: []
  };
  
  // Helpers
  function $(id) { return document.getElementById(id); }
  function $$(sel) { return document.querySelectorAll(sel); }
  
  function toast(msg, isError) {
    var t = $('toast');
    t.textContent = msg;
    t.className = 'toast show' + (isError ? ' error' : '');
    setTimeout(function() { t.className = 'toast'; }, 3000);
  }
  
  function initials(name) {
    if (!name) return '?';
    var parts = name.trim().split(/\s+/);
    if (parts.length >= 2) return (parts[0][0] + parts[parts.length-1][0]).toUpperCase();
    return name.substring(0, 2).toUpperCase();
  }
  
  // Storage
  function save() {
    try {
      localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify({
        units: state.units,
        settings: state.settings
      }));
    } catch(e) {}
  }
  
  function load() {
    state.units = DEFAULT_UNITS.slice();
    state.settings = { adminPassword: CONFIG.ADMIN_PWD, apiUrl: CONFIG.API_URL };
    
    try {
      var data = JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEY));
      if (data && data.units && data.units.length) state.units = data.units;
      if (data && data.settings) {
        state.settings.adminPassword = data.settings.adminPassword || CONFIG.ADMIN_PWD;
        state.settings.apiUrl = data.settings.apiUrl || CONFIG.API_URL;
      }
    } catch(e) {}
  }
  
  // Modals
  function openModal(id) { $(id).classList.add('active'); }
  function closeModal(id) { $(id).classList.remove('active'); }
  
  // Units
  function renderUnits() {
    var grid = $('unitsGrid');
    var html = '';
    
    for (var i = 0; i < state.units.length; i++) {
      var u = state.units[i];
      html += '<div class="unit-card" style="--unit-color:' + u.color + '" onclick="App.openUnit(\'' + u.id + '\')">' +
        '<div class="unit-card-lock"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></div>' +
        '<div class="unit-card-icon">' + u.icon + '</div>' +
        '<div class="unit-card-name">' + u.name + '</div>' +
        '<div class="unit-card-desc">' + (u.desc || '') + '</div>' +
      '</div>';
    }
    
    grid.innerHTML = html;
  }
  
  function openUnit(unitId) {
    var unit = null;
    for (var i = 0; i < state.units.length; i++) {
      if (state.units[i].id === unitId) { unit = state.units[i]; break; }
    }
    if (!unit) return;
    
    state.selectedUnitId = unitId;
    $('accessIcon').textContent = unit.icon;
    $('accessTitle').textContent = unit.name;
    $('codeError').classList.remove('show');
    $('userSection').style.display = 'none';
    $('enterUnitBtn').style.display = 'none';
    
    // Create code inputs
    var html = '';
    for (var j = 0; j < 4; j++) {
      html += '<input type="tel" class="code-digit" maxlength="1" data-idx="' + j + '" inputmode="numeric">';
    }
    $('codeInputs').innerHTML = html;
    
    // Setup code input handlers
    var inputs = $$('.code-digit');
    for (var k = 0; k < inputs.length; k++) {
      (function(idx, inp) {
        inp.oninput = function() {
          var val = inp.value.replace(/\D/g, '');
          inp.value = val;
          if (val && idx < 3) inputs[idx + 1].focus();
          
          // Check code
          var code = '';
          for (var m = 0; m < inputs.length; m++) code += inputs[m].value;
          if (code.length === 4) {
            if (code === unit.code) {
              for (var n = 0; n < inputs.length; n++) {
                inputs[n].classList.add('success');
                inputs[n].disabled = true;
              }
              $('codeError').classList.remove('show');
              $('userSection').style.display = 'block';
              $('enterUnitBtn').style.display = 'flex';
              $('userName').focus();
            } else {
              $('codeError').classList.add('show');
              for (var p = 0; p < inputs.length; p++) inputs[p].classList.add('error');
              setTimeout(function() {
                for (var q = 0; q < inputs.length; q++) inputs[q].classList.remove('error');
              }, 400);
            }
          }
        };
        inp.onkeydown = function(e) {
          if (e.key === 'Backspace' && !inp.value && idx > 0) inputs[idx - 1].focus();
        };
      })(k, inputs[k]);
    }
    
    openModal('accessModal');
    setTimeout(function() { inputs[0].focus(); }, 100);
  }
  
  function enterUnit() {
    var name = $('userName').value.trim();
    var role = $('userRole').value;
    
    if (!name) { toast('Please enter your name', true); return; }
    
    for (var i = 0; i < state.units.length; i++) {
      if (state.units[i].id === state.selectedUnitId) {
        state.currentUnit = state.units[i];
        break;
      }
    }
    state.currentUser = { name: name, role: role };
    
    closeModal('accessModal');
    showDashboard();
  }
  
  // Admin
  function openAdminLogin() {
    $('adminPwd').value = '';
    $('adminError').classList.remove('show');
    openModal('adminLoginModal');
    setTimeout(function() { $('adminPwd').focus(); }, 100);
  }
  
  function loginAdmin() {
    var pwd = $('adminPwd').value;
    if (pwd === state.settings.adminPassword) {
      closeModal('adminLoginModal');
      showAdminPanel();
    } else {
      $('adminError').classList.add('show');
    }
  }
  
  function showAdminPanel() {
    $('landing').classList.add('hidden');
    $('adminPanel').classList.add('active');
    $('apiUrl').value = state.settings.apiUrl || '';
    renderUnitsTable();
  }
  
  function exitAdmin() {
    $('adminPanel').classList.remove('active');
    $('landing').classList.remove('hidden');
  }
  
  function renderUnitsTable() {
    var html = '';
    for (var i = 0; i < state.units.length; i++) {
      var u = state.units[i];
      html += '<tr><td>' + u.icon + ' <b>' + u.name + '</b></td><td><code style="background:var(--bg-elevated);padding:4px 10px;border-radius:6px">' + u.code + '</code></td><td><button class="btn-icon" onclick="App.editUnit(\'' + u.id + '\')">‚úèÔ∏è</button> <button class="btn-icon" onclick="App.deleteUnit(\'' + u.id + '\')">üóëÔ∏è</button></td></tr>';
    }
    $('unitsTableBody').innerHTML = html || '<tr><td colspan="3" style="text-align:center;padding:40px;color:var(--text-muted)">No units</td></tr>';
  }
  
  function addUnit() {
    state.editingUnitId = null;
    $('unitModalTitle').textContent = 'Add Unit';
    $('unitName').value = '';
    $('unitIcon').value = 'üè•';
    $('unitCode').value = '';
    $('unitDesc').value = '';
    openModal('unitModal');
  }
  
  function editUnit(id) {
    var unit = null;
    for (var i = 0; i < state.units.length; i++) {
      if (state.units[i].id === id) { unit = state.units[i]; break; }
    }
    if (!unit) return;
    
    state.editingUnitId = id;
    $('unitModalTitle').textContent = 'Edit Unit';
    $('unitName').value = unit.name;
    $('unitIcon').value = unit.icon;
    $('unitCode').value = unit.code;
    $('unitDesc').value = unit.desc || '';
    openModal('unitModal');
  }
  
  function saveUnit() {
    var name = $('unitName').value.trim();
    var icon = $('unitIcon').value.trim() || 'üè•';
    var code = $('unitCode').value.trim();
    var desc = $('unitDesc').value.trim();
    var colorEl = document.querySelector('.color-option.selected');
    var color = colorEl ? colorEl.style.background : '#d4a437';
    
    if (!name) { toast('Unit name required', true); return; }
    if (!/^\d{4}$/.test(code)) { toast('Code must be 4 digits', true); return; }
    
    if (state.editingUnitId) {
      for (var i = 0; i < state.units.length; i++) {
        if (state.units[i].id === state.editingUnitId) {
          state.units[i] = { id: state.editingUnitId, name: name, icon: icon, code: code, desc: desc, color: color };
          break;
        }
      }
      toast('Unit updated!');
    } else {
      state.units.push({ id: 'unit-' + Date.now(), name: name, icon: icon, code: code, desc: desc, color: color });
      toast('Unit created!');
    }
    
    save();
    renderUnitsTable();
    renderUnits();
    closeModal('unitModal');
  }
  
  function deleteUnit(id) {
    if (!confirm('Delete this unit?')) return;
    state.units = state.units.filter(function(u) { return u.id !== id; });
    save();
    renderUnitsTable();
    renderUnits();
    toast('Unit deleted');
  }
  
  function selectColor(el) {
    var all = $$('.color-option');
    for (var i = 0; i < all.length; i++) all[i].classList.remove('selected');
    el.classList.add('selected');
  }
  
  function saveSettings() {
    var pwd = $('newAdminPwd').value.trim();
    var url = $('apiUrl').value.trim();
    if (pwd) state.settings.adminPassword = pwd;
    if (url) state.settings.apiUrl = url;
    save();
    toast('Settings saved!');
    $('newAdminPwd').value = '';
  }
  
  // Dashboard
  function showDashboard() {
    $('landing').classList.add('hidden');
    $('dashboard').classList.add('active');
    
    var u = state.currentUnit;
    $('unitBadge').textContent = u.name;
    $('unitBadge').style.cssText = 'border:1px solid ' + u.color + ';color:' + u.color + ';background:' + u.color + '20';
    $('userName2').textContent = state.currentUser.name;
    $('userRole2').textContent = state.currentUser.role;
    $('userAvatar').textContent = initials(state.currentUser.name);
    $('welcomeMsg').textContent = 'Welcome, Dr. ' + state.currentUser.name.split(' ')[0];
    $('dateStr').textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
    
    loadPatients();
    renderScores();
    renderRefs();
    toast('Entered ' + u.name);
  }
  
  function logout() {
    state.currentUnit = null;
    state.currentUser = null;
    $('dashboard').classList.remove('active');
    $('landing').classList.remove('hidden');
  }
  
  function showTab(tabName) {
    var tabs = $$('.tab');
    var panels = $$('.panel');
    
    for (var i = 0; i < tabs.length; i++) tabs[i].classList.remove('active');
    for (var j = 0; j < panels.length; j++) panels[j].classList.remove('active');
    
    event.currentTarget.classList.add('active');
    $('panel' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).classList.add('active');
  }
  
  // Patients
  function loadPatients() {
    state.patients = [
      { id: 1, name: 'Ahmed Al-Rashid', room: '21-A', diagnosis: 'Acute Ischemic Stroke - MCA territory', status: 'critical', doctor: 'Dr. Fathy' },
      { id: 2, name: 'Fatima Hassan', room: '21-B', diagnosis: 'CHF Exacerbation, EF 25%', status: 'active', doctor: 'Dr. Fathy' },
      { id: 3, name: 'Mohammed Saeed', room: '22-A', diagnosis: 'DKA, Type 1 DM', status: 'active', doctor: 'Dr. Ahmed' }
    ];
    renderPatients();
  }
  
  function renderPatients() {
    var html = '';
    for (var i = 0; i < state.patients.length; i++) {
      var p = state.patients[i];
      html += '<div class="patient-card ' + p.status + '">' +
        '<div class="patient-header"><div class="patient-avatar">' + initials(p.name) + '</div><div><div class="patient-name">' + p.name + '</div><div class="patient-meta">Room ' + p.room + ' ‚Ä¢ ' + p.doctor + '</div></div><span class="patient-status ' + p.status + '">' + p.status + '</span></div>' +
        '<div class="patient-diagnosis">' + p.diagnosis + '</div>' +
        '<div class="patient-actions"><button class="btn btn-secondary">View</button><button class="btn btn-primary">Rounds</button></div></div>';
    }
    $('patientsGrid').innerHTML = html || '<div style="text-align:center;padding:60px;color:var(--text-muted)">No patients</div>';
    
    $('statTotal').textContent = state.patients.length;
    $('statActive').textContent = state.patients.filter(function(p) { return p.status === 'active'; }).length;
    $('statCritical').textContent = state.patients.filter(function(p) { return p.status === 'critical'; }).length;
    $('statChronic').textContent = state.patients.filter(function(p) { return p.status === 'chronic'; }).length;
  }
  
  function addPatient() { openModal('patientModal'); }
  
  function savePatient() {
    var name = $('ptName').value.trim();
    if (!name) { toast('Patient name required', true); return; }
    
    state.patients.push({
      id: Date.now(),
      name: name,
      room: $('ptRoom').value.trim() || '‚Äî',
      diagnosis: $('ptDiagnosis').value.trim() || 'Pending evaluation',
      status: $('ptStatus').value,
      doctor: state.currentUser ? state.currentUser.name : 'Unassigned'
    });
    
    renderPatients();
    closeModal('patientModal');
    $('ptName').value = '';
    $('ptRoom').value = '';
    $('ptDiagnosis').value = '';
    toast('Patient added!');
  }
  
  // Analysis
  function setAnalysisType(el, type) {
    var all = $$('.analysis-type');
    for (var i = 0; i < all.length; i++) all[i].classList.remove('active');
    el.classList.add('active');
    state.analysisType = type;
  }
  
  function handleFiles(files) {
    if (files.length) {
      $('uploadZone').classList.add('has-file');
      $('analyzeBtn').disabled = false;
      state.uploadedImages = Array.from(files);
      toast(files.length + ' file(s) ready');
    }
  }
  
  function analyze() {
    toast('Analysis feature ready - connect API');
  }
  
  // Scores
  var SCORES = {
    nihss: { name: 'NIHSS', icon: 'üß†', desc: 'Stroke', max: 42 },
    gcs: { name: 'GCS', icon: 'üëÅ', desc: 'Consciousness', max: 15 },
    chadsvasc: { name: 'CHA‚ÇÇDS‚ÇÇ-VASc', icon: '‚ù§Ô∏è', desc: 'AF Risk', max: 9 },
    wells: { name: 'Wells PE', icon: 'ü´Å', desc: 'PE Risk', max: 12 },
    curb65: { name: 'CURB-65', icon: 'ü¶†', desc: 'Pneumonia', max: 5 }
  };
  
  function renderScores() {
    var html = '';
    for (var key in SCORES) {
      var s = SCORES[key];
      html += '<div class="score-tile" onclick="App.selectScore(\'' + key + '\')"><div class="score-icon">' + s.icon + '</div><div class="score-name">' + s.name + '</div><div class="score-desc">' + s.desc + '</div></div>';
    }
    $('scoresGrid').innerHTML = html;
  }
  
  function selectScore(key) {
    var tiles = $$('.score-tile');
    for (var i = 0; i < tiles.length; i++) tiles[i].classList.remove('active');
    event.currentTarget.classList.add('active');
    toast(SCORES[key].name + ' calculator selected');
  }
  
  // Reference
  var REFS = [
    { title: 'üö® Critical Labs', content: '<b>K:</b> <2.5 or >6.5 mEq/L<br><b>Na:</b> <120 or >160 mEq/L<br><b>Glucose:</b> <40 or >500 mg/dL' },
    { title: '‚ö° Hyperkalemia', content: '<b>Stabilize:</b> Ca gluconate 10mL IV<br><b>Shift:</b> Insulin 10U + D50<br><b>Remove:</b> Kayexalate, HD' },
    { title: '‚ù§Ô∏è ACS Protocol', content: '<b>MONA:</b> Morphine, O‚ÇÇ, Nitrates, Aspirin<br><b>STEMI:</b> PCI <90min' },
    { title: 'üß† Stroke tPA', content: '<b>Window:</b> ‚â§4.5h from last known well<br><b>Dose:</b> 0.9 mg/kg (max 90mg)<br><b>BP:</b> <185/110 pre-tPA' },
    { title: 'ü¶† Sepsis Bundle', content: '<b>Hour-1:</b> Lactate, cultures, antibiotics, 30mL/kg fluids if hypotensive' },
    { title: 'üíä Seizure Rx', content: '<b>1st:</b> Lorazepam 4mg IV<br><b>2nd:</b> Levetiracetam 60mg/kg<br><b>Refractory:</b> Propofol gtt' }
  ];
  
  function renderRefs() {
    var html = '';
    for (var i = 0; i < REFS.length; i++) {
      html += '<div class="ref-card"><h4>' + REFS[i].title + '</h4><p>' + REFS[i].content + '</p></div>';
    }
    $('refGrid').innerHTML = html;
  }
  
  // Init
  function init() {
    load();
    renderUnits();
    
    // Modal backdrop close
    var modals = $$('.modal');
    for (var i = 0; i < modals.length; i++) {
      (function(m) {
        m.onclick = function(e) { if (e.target === m) m.classList.remove('active'); };
      })(modals[i]);
    }
    
    // Enter key handlers
    $('adminPwd').onkeydown = function(e) { if (e.key === 'Enter') loginAdmin(); };
    $('userName').onkeydown = function(e) { if (e.key === 'Enter') enterUnit(); };
  }
  
  // Run on load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
  
  // Public API
  return {
    openUnit: openUnit,
    enterUnit: enterUnit,
    openAdminLogin: openAdminLogin,
    loginAdmin: loginAdmin,
    exitAdmin: exitAdmin,
    addUnit: addUnit,
    editUnit: editUnit,
    saveUnit: saveUnit,
    deleteUnit: deleteUnit,
    selectColor: selectColor,
    saveSettings: saveSettings,
    logout: logout,
    showTab: showTab,
    addPatient: addPatient,
    savePatient: savePatient,
    setAnalysisType: setAnalysisType,
    handleFiles: handleFiles,
    analyze: analyze,
    selectScore: selectScore,
    closeModal: closeModal
  };
  
})();
</script>
</body>
</html>
