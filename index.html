<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
  <meta name="theme-color" content="#060a13">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>MedWard Enterprise</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<!-- LANDING -->
<div id="landing">
  <div class="landing-logo">
    <svg viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
  </div>
  <h1 class="landing-title">MedWard Enterprise</h1>
  <p class="landing-subtitle">Select your unit to continue</p>
  <div class="units-grid" id="unitsGrid"></div>
  <div class="admin-fab" onclick="MedWard.App.openAdminLogin()">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <circle cx="12" cy="12" r="3"/>
      <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c.26.604.852.997 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/>
    </svg>
  </div>
</div>

<!-- ACCESS MODAL -->
<div class="modal" id="accessModal">
  <div class="modal-box">
    <div class="modal-header" style="text-align:center">
      <div id="accessIcon" style="font-size:2.5rem;margin-bottom:8px">üè•</div>
      <div class="modal-title" id="accessTitle">Unit</div>
      <div style="color:var(--text-muted);font-size:0.8rem;margin-top:4px">Enter 4-digit code</div>
    </div>
    <div class="modal-body">
      <div class="code-inputs" id="codeInputs"></div>
      <p class="code-error" id="codeError">Invalid code</p>
      <div id="userSection" style="display:none;margin-top:20px;padding-top:20px;border-top:1px solid var(--border)">
        <div class="form-group">
          <label class="form-label">Your Name</label>
          <input type="text" id="userName" class="form-input" placeholder="Dr. Name">
        </div>
        <div class="form-group">
          <label class="form-label">Role</label>
          <select id="userRole" class="form-select">
            <option value="attending">Attending</option>
            <option value="resident">Resident</option>
            <option value="intern">Intern</option>
            <option value="nurse">Nurse</option>
          </select>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="MedWard.Utils.closeModal('accessModal')">Cancel</button>
      <button class="btn btn-primary" id="enterBtn" style="display:none" onclick="MedWard.App.enterUnit()">Enter Unit</button>
    </div>
  </div>
</div>

<!-- ADMIN LOGIN MODAL -->
<div class="modal" id="adminModal">
  <div class="modal-box">
    <div class="modal-header" style="text-align:center">
      <div style="font-size:2.5rem;margin-bottom:8px">‚öôÔ∏è</div>
      <div class="modal-title">Admin Access</div>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Password</label>
        <input type="password" id="adminPwd" class="form-input" placeholder="Password">
      </div>
      <p class="code-error" id="adminError">Invalid password</p>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="MedWard.Utils.closeModal('adminModal')">Cancel</button>
      <button class="btn btn-primary" onclick="MedWard.App.loginAdmin()">Login</button>
    </div>
  </div>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel">
  <header class="admin-header">
    <div style="display:flex;align-items:center;gap:8px">
      <div class="dash-logo-icon">
        <svg viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2" stroke-width="2"/></svg>
      </div>
      <span style="font-weight:600">MedWard</span>
      <span style="background:var(--purple);padding:2px 8px;border-radius:100px;font-size:0.65rem;font-weight:600;margin-left:8px">ADMIN</span>
    </div>
    <button class="btn btn-secondary btn-sm" onclick="MedWard.App.exitAdmin()">Exit</button>
  </header>
  <div class="admin-content">
    <div class="admin-section">
      <div class="admin-section-header">
        <div class="admin-section-title">üè• Units</div>
        <button class="btn btn-primary btn-sm" onclick="MedWard.App.addUnit()">+ Add</button>
      </div>
      <div class="admin-section-body" style="padding:0">
        <table class="units-table">
          <thead><tr><th>Unit</th><th>Code</th><th>Actions</th></tr></thead>
          <tbody id="unitsTable"></tbody>
        </table>
      </div>
    </div>
    <div class="admin-section">
      <div class="admin-section-header">
        <div class="admin-section-title">‚öôÔ∏è Settings</div>
      </div>
      <div class="admin-section-body">
        <div class="form-group">
          <label class="form-label">Admin Password</label>
          <input type="password" id="newAdminPwd" class="form-input" placeholder="Leave blank to keep current">
        </div>
        <div class="form-group">
          <label class="form-label">Claude API URL (Apps Script)</label>
          <input type="text" id="apiUrl" class="form-input" placeholder="https://script.google.com/...">
        </div>
        <button class="btn btn-primary" onclick="MedWard.App.saveSettings()">Save Settings</button>
      </div>
    </div>
  </div>
</div>

<!-- DASHBOARD -->
<div id="dashboard">
  <header class="dash-header">
    <div class="dash-logo">
      <div class="dash-logo-icon">
        <svg viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2" stroke-width="2"/></svg>
      </div>
      <span class="dash-badge" id="unitBadge">Unit</span>
    </div>
    <div class="dash-user">
      <div class="dash-avatar" id="dashAvatar">DR</div>
      <button class="btn-icon" onclick="MedWard.App.logout()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
          <polyline points="16 17 21 12 16 7"/>
          <line x1="21" y1="12" x2="9" y2="12"/>
        </svg>
      </button>
    </div>
  </header>
  
  <div class="dash-content">
    <div class="tabs">
      <button class="tab active" onclick="MedWard.App.showTab('patients',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
          <circle cx="9" cy="7" r="4"/>
        </svg>
        <span>Patients</span>
      </button>
      <button class="tab" onclick="MedWard.App.showTab('analysis',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V8l-6-6z"/>
          <path d="M14 3v5h5M16 13H8M16 17H8M10 9H8"/>
        </svg>
        <span>AI Analysis</span>
      </button>
      <button class="tab" onclick="MedWard.App.showTab('reference',this)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
          <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
        </svg>
        <span>Reference</span>
      </button>
    </div>
    
    <!-- PATIENTS PANEL -->
    <div class="panel active" id="panelPatients">
      <div class="stats">
        <div class="stat"><div class="stat-value" id="statTotal">0</div><div class="stat-label">Total</div></div>
        <div class="stat"><div class="stat-value" id="statActive">0</div><div class="stat-label">Active</div></div>
        <div class="stat"><div class="stat-value" id="statCritical">0</div><div class="stat-label">Critical</div></div>
        <div class="stat"><div class="stat-value" id="statChronic">0</div><div class="stat-label">Chronic</div></div>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-wrap:wrap;gap:10px">
        <div style="font-weight:600;font-size:1rem">Patients</div>
        <div style="display:flex;gap:8px">
          <button class="btn btn-secondary btn-sm" onclick="MedWard.Import.open()" style="border-color:var(--gold);color:var(--gold)">üì• Import</button>
          <button class="btn btn-primary btn-sm" onclick="MedWard.Patients.openAdd()">+ Add</button>
        </div>
      </div>
      <div class="patients-list" id="patientsList"></div>
    </div>
    
    <!-- ANALYSIS PANEL -->
    <div class="panel" id="panelAnalysis">
      <div class="card">
        <div class="card-header">üî¨ AI Medical Analysis</div>
        <div class="card-body">
          <div class="upload-zone" onclick="document.getElementById('analysisFile').click()">
            <div class="upload-zone-icon">üì§</div>
            <div style="font-weight:600">Upload Medical Images</div>
            <div style="font-size:0.8rem;color:var(--text-muted);margin-top:4px">Labs, X-Rays, CT/MRI, ECG ‚Ä¢ Select multiple</div>
          </div>
          <input type="file" id="analysisFile" accept="image/*" multiple style="display:none">
          <div class="analysis-types">
            <div class="analysis-type active" onclick="MedWard.Analysis.setType('lab',this)">
              <div class="analysis-type-icon">üß™</div>
              <div class="analysis-type-name">Labs</div>
            </div>
            <div class="analysis-type" onclick="MedWard.Analysis.setType('xray',this)">
              <div class="analysis-type-icon">ü©ª</div>
              <div class="analysis-type-name">X-Ray</div>
            </div>
            <div class="analysis-type" onclick="MedWard.Analysis.setType('ct',this)">
              <div class="analysis-type-icon">üß†</div>
              <div class="analysis-type-name">CT/MRI</div>
            </div>
            <div class="analysis-type" onclick="MedWard.Analysis.setType('ecg',this)">
              <div class="analysis-type-icon">üíì</div>
              <div class="analysis-type-name">ECG</div>
            </div>
          </div>
          <div id="analysisPreview" style="display:none;margin-top:16px"></div>
        </div>
      </div>
      <button class="btn btn-primary btn-full" id="analyzeBtn" onclick="MedWard.Analysis.run()" disabled>ü§ñ Analyze with Claude AI</button>
      <div id="analysisLoading" style="display:none;text-align:center;padding:30px">
        <div class="spinner"></div>
        <div style="margin-top:12px;font-weight:600">Analyzing...</div>
      </div>
      <div id="analysisResults" style="margin-top:16px"></div>
    </div>
    
    <!-- REFERENCE PANEL -->
    <div class="panel" id="panelReference">
      <div class="card">
        <div class="card-header">üìö Quick Reference</div>
        <div class="card-body">
          <div class="ref-grid" id="refGrid"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- PATIENT MODAL -->
<div class="modal" id="patientModal">
  <div class="modal-box">
    <div class="modal-header">
      <div class="modal-title" id="patientModalTitle">Add Patient</div>
    </div>
    <div class="modal-body">
      <input type="hidden" id="ptId">
      <div class="form-group">
        <label class="form-label">Name</label>
        <input type="text" id="ptName" class="form-input" placeholder="Full name">
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="form-group">
          <label class="form-label">Room</label>
          <input type="text" id="ptRoom" class="form-input" placeholder="21-A">
        </div>
        <div class="form-group">
          <label class="form-label">Status</label>
          <select id="ptStatus" class="form-select">
            <option value="active">Active</option>
            <option value="critical">Critical</option>
            <option value="chronic">Chronic</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Diagnosis</label>
        <textarea id="ptDx" class="form-textarea" placeholder="Primary diagnosis"></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="MedWard.Utils.closeModal('patientModal')">Cancel</button>
      <button class="btn btn-primary" onclick="MedWard.Patients.save()">Save</button>
    </div>
  </div>
</div>

<!-- UNIT MODAL -->
<div class="modal" id="unitModal">
  <div class="modal-box">
    <div class="modal-header">
      <div class="modal-title" id="unitModalTitle">Add Unit</div>
    </div>
    <div class="modal-body">
      <div class="form-group">
        <label class="form-label">Name</label>
        <input type="text" id="uName" class="form-input" placeholder="Neurology">
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="form-group">
          <label class="form-label">Icon</label>
          <input type="text" id="uIcon" class="form-input" value="üè•" style="font-size:1.3rem;text-align:center">
        </div>
        <div class="form-group">
          <label class="form-label">Code (4 digits)</label>
          <input type="text" id="uCode" class="form-input" placeholder="1234" maxlength="4">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Description</label>
        <input type="text" id="uDesc" class="form-input" placeholder="Brief description">
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="MedWard.Utils.closeModal('unitModal')">Cancel</button>
      <button class="btn btn-primary" onclick="MedWard.App.saveUnit()">Save</button>
    </div>
  </div>
</div>

<!-- IMPORT MODAL -->
<div class="modal" id="importModal">
  <div class="modal-box" style="max-width:500px">
    <div class="modal-header">
      <div class="modal-title">üì• Import Patients</div>
      <div style="font-size:0.8rem;color:var(--text-muted);margin-top:4px">AI extracts patient data from screenshots</div>
    </div>
    <div class="modal-body">
      <div id="importUpload">
        <div class="import-dropzone" onclick="document.getElementById('importFile').click()">
          <div style="font-size:2rem;margin-bottom:8px">üì§</div>
          <div style="font-weight:600">Upload Screenshot</div>
          <div style="font-size:0.8rem;color:var(--text-muted);margin-top:4px">Excel, Sheets, or EMR screenshot</div>
        </div>
        <input type="file" id="importFile" accept="image/*" style="display:none">
      </div>
      <div id="importPreview" style="display:none">
        <img id="importImg" src="" style="width:100%;max-height:150px;object-fit:contain;border-radius:8px">
        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="btn btn-secondary btn-sm" onclick="MedWard.Import.reset()" style="flex:1">Change</button>
          <button class="btn btn-primary btn-sm" onclick="MedWard.Import.analyze()" style="flex:2">ü§ñ Extract Patients</button>
        </div>
      </div>
      <div id="importLoading" style="display:none;text-align:center;padding:30px">
        <div class="spinner"></div>
        <div style="margin-top:12px">Extracting patients...</div>
      </div>
      <div id="importResults" style="display:none">
        <div style="display:flex;justify-content:space-between;margin-bottom:12px">
          <span style="font-weight:600">‚úì Found Patients</span>
          <span id="importCount" style="background:var(--emerald);color:white;padding:2px 10px;border-radius:100px;font-size:0.75rem">0</span>
        </div>
        <div id="importList" style="max-height:250px;overflow-y:auto"></div>
      </div>
      <div id="importError" style="display:none;text-align:center;padding:20px;color:var(--rose)">
        <div style="font-size:1.5rem;margin-bottom:8px">‚ö†Ô∏è</div>
        <div id="importErrorMsg">Error</div>
        <button class="btn btn-secondary btn-sm" onclick="MedWard.Import.reset()" style="margin-top:12px">Try Again</button>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="MedWard.Utils.closeModal('importModal')">Cancel</button>
      <button class="btn btn-primary" id="importBtn" onclick="MedWard.Import.confirm()" disabled>Import</button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- JavaScript Modules -->
<script src="js/config.js"></script>
<script src="js/utils.js"></script>
<script src="js/storage.js"></script>
<script src="js/patients.js"></script>
<script src="js/analysis.js"></script>
<script src="js/import.js"></script>
<script src="js/app.js"></script>

</body>
</html>
